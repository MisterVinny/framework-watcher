<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>JavaScript Framework Watcher</title>
  </head>
  <body>
    <div>
      <div style="float: left; padding-left: 64px">
        <h1>Vue</h1>
        <div id="vueDiv"></div>
      </div>
      <!-- <div style="float: left; padding-left: 64px">
        <h1>Angular</h1>
        <div id="angularData"></div>
      </div>
      <div style="float: left; padding-left: 64px">
        <h1>Ember</h1>
        <div id="emberData"></div>
      </div>
      <div style="float: left; padding-left: 64px">
        <h1>Svelte</h1>
        <div id="svelteData"></div>
      </div>
      <div style="float: left; padding-left: 64px">
        <h1>React</h1>
        <div id="reactData"></div>
      </div> -->
    </div>

    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script>
      // To be used to store values for each framework dataset
      var vueData = getData("vuejs/vue", "vueDiv");
      var angularData = {};
      var emberData = {};
      var svelteData = {};
      var reactData = {};

      // Need to completely re-work this. Because fetch is asynchronous,
      // it can't just dump data into global variables the same way that the
      // data section works in Vue. By the time chart.js is called, this data
      // does not exist yet... maybe turn this into a function that pulls the data
      // from within the chart.js data section instead. Then Chart will be
      // fetching the data when it is needed. The tasks can be split - one to
      // populate data DIV's on the page and then one to feed Chart.js what it needs.

      // Follow-up to above, this works and will be more modular. Keep going.
      // Currently populates page, but can now be used in Chart.js to get data
      // AND populate the page in  one go.

      //      ######  gets Vue data   ######
      function getData(framework, divName) {
        fetch(`https://api.github.com/repos/${framework}`)
          .then((response) => response.json())
          .then((data) => {
            const frameworkData = {
              forks: data.forks,
              stars: data.stargazers_count,
              watchers: data.subscribers_count,
            };
            appendData(frameworkData, divName);
            return frameworkData;
          })
          .catch(function (err) {
            console.log("error: " + err);
          });
      }

      // appendData function called above to append to div
      function appendData(data, id) {
        var mainDivContainer = document.getElementById(id);
        var div = document.createElement("div");
        div.innerHTML = "Forks: " + data.forks;
        mainDivContainer.appendChild(div);
        var div = document.createElement("div");
        div.innerHTML = "Stars: " + data.stars;
        mainDivContainer.appendChild(div);
        var div = document.createElement("div");
        div.innerHTML = "Watchers: " + data.watchers;
        mainDivContainer.appendChild(div);
      }

      // ########## Begin Chart.js Scripting ##########
      console.log("later", vueData);
      const labels = ["Forks", "Stars", "Watchers"];
      const data = {
        labels: labels,
        datasets: [
          {
            label: "Vue Data",
            data: [25435, vueData.stars, 33456],
            backgroundColor: ["rgba(255, 99, 132, 0.2)"],
            borderColor: ["rgb(255, 99, 132)"],
            borderWidth: 1,
          },
        ],
      };
      const config = {
        type: "bar",
        data: data,
        options: {
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      };

      // Creates the new chart
      var myChart = new Chart(document.getElementById("myChart"), config);
    </script>
  </body>
</html>
